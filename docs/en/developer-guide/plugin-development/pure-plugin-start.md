# Start in pure plugin mode

Pure plugin mode provides lightweight testing capabilities for iLogtail plugin development. The following section describes how to start iLogtail in pure plugin mode.

## Local startup

Run the 'make plugin_main' command in the root directory to obtain the 'output/ilogtail' executable file. Run the following command to quickly start the iLogtail program and output logs in the console.

```shell
# By default, the startup behavior of the plugin is to use the metric_mock plugin to mock data and print the data in log mode.
 ./output/ilogtail --logger-console=true --logger-retain=false
```

## Configure

iLogtail currently provides the following four modes for configuration:

* Specify the configuration file mode to start.
* File-to-file quick test
* iLogtail the Http port is exposed, you can change the configuration.
* iLogtail-C change the configuration of the program through the program API.

### Specify the configuration file mode to start

After compiling ilogtail executable program in standalone mode, you can start it by specifying a configuration file (if not specified, the default file is plugin.json in the current directory).

```json
{
    "inputs": [
        {
            "type": "plugin name"
            "detail": {
                "Parameter1": "value"
                "Parameter2": 10
            }
        },
        { ... }
    ],
    "processors": [ ... ],
    "aggregators": [ ... ],
    "flushers": [ ... ]
}
```

First, as shown above, the configuration file is a standard JSON file. The four top-level keys correspond to the four plugins mentioned in the article:

* inputs: input the plugin to obtain data.
* processors: the processing plugin processes the obtained data.
* aggregators: the aggregation plugin that aggregates data.
* flushers: the output plugin outputs data to the specified sink.

It can be seen from their type of array that in a configuration, each type of plugin can specify multiple items at the same time, but note the relationship between multiple plugins of the same type at the same time. Except for the string relationship between the processors, the other types are parallel, as shown in the following figure:

![Picture](https://sls-opensource.oss-us-west-1.aliyuncs.com/ilogtail/logtail-libPluginBase.png?versionId=CAEQMxiBgIDM6YCk6BciIDBjYmVkZjQ2Yjg5NzQwY2NhZjI4MmFmZDA2M2MwZTU2)

For each object in the array, they specify a specific plugin. The type field specifies the name of the plugin, and the object corresponding to the detail field specifies the configuration for the plugin.

The following is a very simple sample configuration file (plugin.quickstart.json):

* inputs: use the metric\_mock plugin to generate mock data. By setting detail, the mock data generated by the two plugins will be different.
* processors: use the processor\_default plugin. This plugin does not perform any operations on data, but simply returns the data to keep it as it is.
* flushers: Use the flusher\_stdout plugin to output data to a local file. Similarly, we also use detail to output data to two files at the same time.

```json
{
   "inputs":[
      {
         "type":"metric_mock",
         "detail":{
            "Index":0,
            "Fields":{
               "Content":"quickstart_input_1"
            }
         }
      },
      {
         "type":"metric_mock",
         "detail":{
            "Index":100000000,
            "Fields":{
               "Content":"quickstart_input_2"
            }
         }
      }
   ],
   "processors":[
      {
         "type":"processor_default"
      }
   ],
   "flushers":[
      {
         "type":"flusher_stdout",
         "detail":{
            "FileName":"quickstart_1.stdout"
         }
      },
      {
         "type":"flusher_stdout",
         "detail":{
            "FileName":"quickstart_2.stdout"
         }
      }
   ]
}
```

Execute `./output/ilogtail -- plugin = plugin.quickstart.json`. After a period of time, use ctrl + c to interrupt the operation. By viewing the directory, you will find that quickstart\_1 is generated.stdout and quickstart\_2.stdout are two files, and their contents are the same. Viewing the Content shows that each piece of data contains two keys, Index and Content, and the Content is different because there are two input plugins.

### File-to-file quick test

You can use the following commands to input data from a file and output it to a file for quick configuration testing.

```shell
./output/ilogtail --plugin=plugin.json --file-io=true
```

Before testing, you need to create the json format configuration file mentioned above. Different from the preceding, the configuration file does not need to configure inputs and flushers (if configured, inputs will become invalid and flushers will be retained). When the file-io switch is turned on,It is automatically specified as the file input and output to the file. The default input file is input.log and the default output file is output.log. You can also set input-file and output-file parameters to modify the input and output files.

Note that the fieldKey of each row of data read is content by default. You can use the input-field parameter to modify the Field name. Instead of reading all input files, 1,000 lines are read from the beginning by default. You can modify the input-line-limit parameter to read the required number of lines.

The following is a simple example. Create a collection configuration plugin.file2filetest.json for json parsing. The input source file is stdin.log and the output result is sent to the stdout.log file.

The configuration file plugin.file2filetest.json is as follows:

```json
{
    "processors": [
        {
            "detail": {
                "SourceKey": "content",
                "KeepSource": false,
                "ExpandDepth": 1,
                "ExpandConnector": ""
            },
            "type": "processor_json"
        }
    ]
}
```

The content of stdin.log is as follows:

```text
{"inputs":[{"type":"metric_mock","detail":{"Tags":{"tag1":"aaaa","tag2":"bbb"},"Fields":{"content":"xxxxx","time":"2017.09.12 20:55:36"}}}],"flushers":[{"type":"flusher_stdout"}]}
```

Run the following command:

```shell
./output/ilogtail --plugin=plugin.file2filetest.json --file-io=true --input-file=stdin.log --output-file=stdout.log
```

You can find that a stdout.log file is generated. The content is as follows:

```text
2023-05-23 11:33:48 {"inputs":"[{\"type\":\"metric_mock\",\"detail\":{\"Tags\":{\"tag1\":\"aaaa\",\"tag2\":\"bbb\"},\"Fields\":{\"content\":\"xxxxx\",\"time\":\"2017.09.12 20:55:36\"}}}]","flushers":"[{\"type\":\"flusher_stdout\"}]","__time__":"1684841628"}
```

### HTTP API configuration changes

When the iLogtail is running in standalone mode, you can use the HTTP API to change the configuration file.

* Port: When the iLogtail is running independently, Port 18689 is started by default for listening configuration input.
* 接口：/loadconfig

Next, we will use HTTP mode to re-load the static configuration case in the **specified configuration file mode.

1. First, we start iLogtail program: './output/ilogtail'
2. Use the following command to reload the configuration.

    ```shell
    curl 127.0.0.1:18689/loadconfig -X POST -d '[{"project":"e2e-test-project","logstore":"e2e-test-logstore","config_name":"test-case_0","logstore_key":1,"json_str":"{\"inputs\":[{\"type\":\"metric_mock\",\"detail\":{\"Index\":0,\"
    Fields\":{\"Content\":\"quickstart_input_1\"}}},{\"type\":\"metric_mock\",\"detail\":{\"Index\":100000000,\"Fields\":{\"Content\":\"quickstart_input_2\"}}}],\"processors\":[{\"type\":\"processor_default\"}],\"flushers\":[{\"type\":\"flusher_stdout\",\"detail\":{\"FileName\":\"quickstart_1.stdout\"}},{\"type\":\"flusher_stdout\",\"detail\":{\"FileName\":\"quickstart_2.stdout\"}}]}\n"}]'
    ```

3. View the logs and observe configuration changes.

    ```log
    2021-11-15 14:38:42 [INF] [logstore_config.go:113] [Start] [logtail_alarm,logtail_alarm]        config start:begin      
    2021-11-15 14:38:42 [INF] [logstore_config.go:151] [Start] [logtail_alarm,logtail_alarm]        config start:success    
    2021-11-15 14:38:42 [INF] [logstore_config.go:113] [Start] [test-case_0,e2e-test-logstore]      config start:begin      
    2021-11-15 14:38:42 [INF] [logstore_config.go:151] [Start] [test-case_0,e2e-test-logstore]      config start:success
    ```

4. By viewing the directory, you will find that the behavior is consistent with the static configuration method described above. Two files, quickstart\_1.stdout and quickstart\_2.stdout, are generated and their contents are consistent.

### C API configuration changes

Compiled in C- shared mode and used in combination with C program. For more information about the open API, see [plugin\_export.go](https://github.com/alibaba/ilogtail/blob/main/plugin\_main/plugin\_export.go).
