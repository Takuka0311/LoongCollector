<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi Collection Agent Benchmark Records</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      html {
        font-family: BlinkMacSystemFont, -apple-system, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue",
          Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        background-color: #fff;
        font-size: 16px;
      }
      body {
        color: #4a4a4a;
        margin: 8px;
        font-size: 1em;
        font-weight: bold; /* 设置所有字体加粗 */
        text-align: center; /* 设置文本居中 */
      }
      .chart-container {
        width: 60%;
        height: auto; /* 设置图表高度为400像素 */
        max-width: 1000px;
        margin: 0 auto; /* 居中对齐 */
      }
      a {
        color: #3273dc;
        cursor: pointer;
        text-decoration: none;
      }
      a:hover {
        color: #000;
      }
      button {
        color: #fff;
        background-color: #3298dc;
        border-color: transparent;
        cursor: pointer;
        text-align: center;
      }
      button:hover {
        background-color: #2793da;
        flex: none;
      }
      footer {
        margin-top: 16px;
        display: flex;
        align-items: center;
      }
      .spacer {
        flex: auto;
      }
      .small {
        font-size: 0.75rem;
      }
    </style>
  </head>
  <body>
    <h1>Multi Collection Agent Benchmark Records</h1>
    <div id="charts-container"></div>
    <footer>
      <button id="dl-button">Download data as JSON</button>
      <div class="spacer"></div>
      <div class="small">
        Powered by
        <a
          rel="noopener"
          href="https://github.com/marketplace/actions/continuous-benchmark"
          >github-action-benchmark</a
        >
      </div>
    </footer>

    <script src="records_all.js"></script>
    <script>
      const container = document.getElementById("charts-container");

      const toolColors = {
        customSmallerIsBetter: "#ff3838",
        customBiggerIsBetter: "#38ff38",
        cargo: "#dea584",
        go: "#00add8",
        benchmarkjs: "#f1e05a",
        benchmarkluau: "#000080",
        pytest: "#3572a5",
        googlecpp: "#f34b7d",
        catch2: "#f34b7d",
        julia: "#a270ba",
        jmh: "#b07219",
        benchmarkdotnet: "#178600",
        _: "#333333",
      };

      function init() {
        const data = groupByLongestPrefix(window.BENCHMARK_RECORDS);

        document.getElementById("dl-button").onclick = () => {
          const dataUrl = "data:," + JSON.stringify(data, null, 2);
          const a = document.createElement("a");
          a.href = dataUrl;
          a.download = "multi_agent_benchmark_data.json";
          a.click();
        };

        return data;
      }

      // Function to group benchmarks by longest name prefix
      function groupByLongestPrefix(records) {
        const groups = {};
        records.forEach((record) => {
          const parts = record.name.split("_");
          let prefix = parts[0];
          for (let i = 1; i < parts.length - 1; i++) {
            prefix += `_${parts[i]}`;
          }
          if (!groups[prefix]) {
            groups[prefix] = [];
          }
          groups[prefix].push(record);
        });
        Object.keys(groups).forEach((prefix) => {
          const maxLength = Math.max(
            ...groups[prefix].map((record) => record.records.length)
          );
          groups[prefix].forEach((record) => {
            while (record.records.length < maxLength) {
              record.records.push(record.records[record.records.length - 1]); // Use null to fill the array
            }
          });
        });
        return groups;
      }

      const groupedRecords = init();

      Object.keys(groupedRecords).forEach((prefix, index) => {
        const chartContainer = document.createElement("div");
        chartContainer.className = "chart-container";
        const canvas = document.createElement("canvas");
        canvas.id = `chart-${index}`;
        chartContainer.appendChild(canvas);
        container.appendChild(chartContainer);

        const datasets = groupedRecords[prefix].map((benchmark, i) => {
          const colorKeys = Object.keys(toolColors);
          const colorKey = colorKeys[i % colorKeys.length];
          const suffix = benchmark.name.split("_").pop();
          return {
            label: suffix,
            data: benchmark.records,
            borderColor: toolColors[colorKey] || toolColors._,
            borderWidth: 1,
            fill: false,
          };
        });

        new Chart(canvas, {
          type: "line",
          data: {
            labels: groupedRecords[prefix][0].records.map((_, i) => i + 1),
            datasets: datasets,
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: prefix,
                font: {
                  size: 20, // 设置标题字体大小
                  weight: "bold", // 设置标题字体加粗
                },
              },
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: "time (s)",
                },
              },
              y: {
                title: {
                  display: true,
                  text: groupedRecords[prefix][0].unit,
                },
              },
            },
          },
        });
      });
    </script>
  </body>
</html>
